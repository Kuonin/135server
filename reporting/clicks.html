<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clicks Report</title>
    <script nonce="undefined" src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script type="module">
        import './zinggrid.min.js';
    </script>
</head>
<body>
    <h1>Detailed Report about User Mouse Clicks</h1>
    <p>Where are Users clicking, is it in intended areas or unexpected areas?</p>
    <div id="clicks"></div>
    <div id="grid"></div>
    <section>
        <h2>Discussion</h2>
        <p>
            When we look at where Users are clicking, we can see that much of it is located near the left side and where there
            are links, such as the links for homework 1 and the links for homework 2. However, to confirm that
            users are indeed clicking on the links and not mistankenly clicking on unclickable things, like the headers
            for each homework section, it would be smart to overlay this graph over the most common screen size dimension.
            By doing so, we can see where users are clicking and if there are any deadclicks. Using the most common screen size
            is not all encompasing though, as there are a variety of screen dimensions people use and may not perfectly line up
            with exactly where they are clicking on the default image but it is still a good helper
            to allowing us developers to better understand the user experience. Also, by including a grid which not
            only has the coordinates of the click but also the session associated with the clicks, if we are able to determine
            that there are dead clicks and get their range of coordinates, we can see the number of sessions that make them. This 
            helps inform us if its only a few users in comparison to the total number of users making these mistakes,
            in which case we can look closer at the information we have about them to figure out why they are clicking there,
            it may be because they all have the same screen dimensions which just causes the clickable items to be located there
            or it could be a more widespread problem. 
        </p>
    </section>
    <script>
    let clicks = [];
    let users = [];
    fetch("https://reporting.katiel.site/api/active")
        .then((response) =>{
            return response.text();
        })
        .then((responses) => {
            console.log(responses);
            let res = JSON.parse('[' + responses.replace(/}{(?=([^"]*"[^"]*")*[^"]*$)/g, '},{') + ']');
            for(const obj of res){
                if('event' in obj){
                    let event = "event";
                    let objEvent = obj[event];
                    console.log(objEvent);
                    if(objEvent == "mouseclick(u)"){
                        clicks.push([obj['x'], obj['y']]);
                        users.push({values : [obj['sessionId'], obj['x'], obj['y']]});
                    }
                }
            }
            console.log(clicks);
            ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "b55b025e438fa8a98e32482b5f768ff5"];
            let chartConfig = {
            type: 'scatter',
            "title": {"text":"User Mouse Clicks"},
            scaleX: {values: "0:1000:100"},
            scaleY : {values: "0:700:100"},
            series: [
                {values : clicks}
            ]
            };
            let gridConfig = {
                type : 'grid', 
                "title" : {"text" : "Users Clicks"},
                options:{
                    headerRow: true,
                    colLabels:['Session Id', 'X Coordinate', 'Y Coordinate']
                },
                series: users
            }
        
            zingchart.render({
            id: 'clicks',
            data: chartConfig,
            height: '100%%',
            width: '100%%'
            });
            zingchart.render({
            id: 'grid',
            data: gridConfig,
            height: '100%%',
            width: '100%%'
            });
        })
        .catch(function(error){
            console.log(error);
        });
    
  </script>
</body>
</html>